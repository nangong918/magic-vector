**操作系统**
====

# 进程与线程
## 进程

## 线程

线程调度，线程状态

### 线程的生命周期
* 新建状态 (New)
  新建了线程，但是未启动。
  状态转变: 当调用 `start()` 方法时，线程从新建状态转变为就绪状态
* 就绪状态 (Runnable)
  线程处于就绪状态时，表示它已经准备好执行，但此时可能由于操作系统的线程调度策略而尚未分配 CPU 时间。等待os调度.
  状态转变: 一旦 CPU 资源可用，线程将从就绪状态转移到运行状态。 如果优先级更高的线程进入就绪状态，该线程可能被暂时挂起。
* 运行状态 (Running)
  线程处于运行状态时，表示它正在执行代码。此状态下线程正在消耗 CPU 资源。
  状态转变: 线程可以通过调用 `yield()` 或 `sleep()` 方法主动让出 CPU，或因资源等待等而进入阻塞状态
* 阻塞状态 (Blocked)
  当线程试图获取对象的锁（例如，通过 `synchronized` 关键字）而该锁已被其他线程持有时，线程进入阻塞状态。
  状态转变: 一旦锁释放，线程将转回就绪状态。 此时，该线程无法继续执行直到能够获取到锁。
* 等待状态 (Waiting)
  线程处于等待状态时，表示它在等待其他线程的通知或特定条件的满足。此状态可以通过调用 `Object.wait()`、`Thread.join()` 或 `LockSupport.park() `等方法进入。
  状态转变: 当被其他线程以 `notify()`、`notifyAll()` 或相关方法唤醒时，线程将转回就绪状态。
* 超时等待状态 (Timed Waiting)
  类似于等待状态，但线程在超时时间内将自动返回到就绪状态，避免无限期等待。可以通过 Thread.sleep(millis) 或 Object.wait(timeout) 等方法进入。
  状态转变: 当超时或被其他线程唤醒，线程将转回就绪状态
* 死亡状态
  描述: 当线程执行完成或因异常终止时，线程进入终止状态。在此状态下，线程资源已经被释放，线程生命周期结束。
  状态转变: 无法再返回其他状态

### 协程及其生命周期
协程（coroutines）是一种轻量级的线程管理工具，通常用于实现异步编程和并发任务处理。与传统线程相比，协程的状态变化和管理方式更加灵活和高效。

#### 协程的生命周期
* 挂起状态 (Suspended)
  当协程遇到挂起点时（例如，调用挂起函数），它会暂停其执行，这是协程的主要特性之一。此时，协程的状态被保存，可以在稍后恢复。
* 运行状态 (Running)
  协程正处于执行状态，可以进行代码运行。在单线程环境中，协程会在其调度器中按顺序执行。
* 完成状态 (Completed)
  当协程完成其任务后，状态转入完成状态。这意味着所有代码已经执行，可能会返回一个结果或抛出错误。
* 取消状态 (Cancelled)
  当协程被外部请求取消时，它进入取消状态。如果协程设计为可取消，它应在适当的地方检查取消状态并清理资源。

### 线程代码实现
```kotlin
fun main() = runBlocking {
    val job = launch {
        println("协程: 开始执行")
        try {
            repeat(5) { i ->
                delay(1000L)  // 挂起协程，模拟耗时任务
                println("协程: 运行 $i")
            }
        } catch (e: CancellationException) {
            println("协程: 被取消")
        } finally {
            println("协程: 清理资源")
        }
    }

    delay(2500L) // 主协程等待一段时间
    println("主协程: 取消协程")
    job.cancel() // 取消协程
    job.join()   // 等待协程完成
    println("主协程: 结束")
}
```

`runBlocking`: 创建一个新的协程作用域，并阻塞当前线程，直到所有协程执行完成。
`launch`: 启动一个新的协程并返回 `Job` 对象（此处于 `job`），允许后续进行取消等操作。
`suspend` 和 `delay`: 使用 `delay` 来模拟耗时的异步操作。该函数本质上是一个挂起函数，允许协程在此期间暂停。
取消机制:
主协程在等待 2500 毫秒后调用 `job.cancel()` 来取消协程。
协程捕获 `CancellationException`，可以在 `catch` 块中处理取消逻辑。
在 `finally` 块中执行资源清理，确保不管协程是正常结束还是被取消，资源都会被妥善处理


Thread
JVM线程池
Java nio
Netty nio
WebFlux
RxJava
Kotlin协程
Handler，Looper，MessageQueue，HandlerThread

### 线程锁

### 线程通讯

# 文件与设备
oss

